<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<title>SyDEVS: Part 2: Creating your First Simulation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css"   rel="stylesheet" type="text/css" />
<link href="eigendoxy.css" rel="stylesheet" type="text/css">
<!--  -->
<script type="text/javascript" src="eigen_navtree_hacks.js"></script>
<!-- <script type="text/javascript"> -->
<!-- </script> -->
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- <a name="top"></a> -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname"><a href="https://autodesk.github.io/sydevs/">SyDEVS</a>
   </div>
   <div id="projectbrief">Multiscale Simulation and Systems Modeling Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('getting_started_part02.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Part 2: Creating your First Simulation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Let's start by creating a few new folders within the <code>sydevs_examples</code> project.</p>
<ol type="1">
<li>In <code>sydevs_examples/src/examples</code>, create a folder named <code>getting_started</code>.</li>
<li>In the new <code>getting_started</code> folder, create a folder named <code>waveform</code>. This is where your first SyDEVS node will be located.</li>
<li>In <code>sydevs_examples/src/simulations</code> make a folder named <code>part02</code>. The code here will invoke the simulation code in <code>sydevs_examples/src/examples/getting_started/waveform</code>.</li>
</ol>
<p>The overall directory structure should now be as follows.</p>
<div class="fragment"><div class="line">sydevs_examples/</div><div class="line">    bin/</div><div class="line">        ...</div><div class="line">    external/</div><div class="line">        ...</div><div class="line">    src/</div><div class="line">        examples/</div><div class="line">            getting_started/</div><div class="line">                waveform/</div><div class="line">        simulations/</div><div class="line">            part01/</div><div class="line">            part02/</div></div><!-- fragment --><p>The <code>CMakeLists.txt</code> file will have to be updated, so let's get that out of the way. Add the following instructions to the <code>Examples</code> section. This prepares a list of the header (.h) files we will later create in the <code>waveform</code> folder.</p>
<div class="fragment"><div class="line">set(WAVEFORM_DIR ${EXAMPLES_DIR}/getting_started/waveform)</div><div class="line">file(GLOB WAVEFORM_HDRS &quot;${WAVEFORM_DIR}/*.h&quot;)</div></div><!-- fragment --><p>Also add the following instructions to the <code>Simulations</code> section. This creates an executable for Part 2 of the tutorial. Observe that the executable references the <code>waveform</code> header files.</p>
<div class="fragment"><div class="line">set(PART02_DIR ${SIMULATIONS_DIR}/part02)</div><div class="line">aux_source_directory(${PART02_DIR} PART02_SRCS)</div><div class="line">add_executable(part02 ${PART02_SRCS} ${WAVEFORM_HDRS})</div><div class="line">target_link_libraries(part02 debug SyDEVS-static-debug optimized SyDEVS-static)</div></div><!-- fragment --><p>The bottom of the <code>CMakeLists.txt</code> file should now appear as follows.</p>
<div class="fragment"><div class="line"># ------------------------------------------------------------------------------</div><div class="line">#</div><div class="line">#   Examples</div><div class="line">#</div><div class="line"># ------------------------------------------------------------------------------</div><div class="line">set(EXAMPLES_DIR src/examples)</div><div class="line"></div><div class="line">set(WAVEFORM_DIR ${EXAMPLES_DIR}/getting_started/waveform)</div><div class="line">file(GLOB WAVEFORM_HDRS &quot;${WAVEFORM_DIR}/*.h&quot;)</div><div class="line"></div><div class="line"># ------------------------------------------------------------------------------</div><div class="line">#</div><div class="line">#   Simulations</div><div class="line">#</div><div class="line"># ------------------------------------------------------------------------------</div><div class="line">set(SIMULATIONS_DIR src/simulations)</div><div class="line"></div><div class="line">set(PART01_DIR ${SIMULATIONS_DIR}/part01)</div><div class="line">aux_source_directory(${PART01_DIR} PART01_SRCS)</div><div class="line">add_executable(part01 ${PART01_SRCS})</div><div class="line">target_link_libraries(part01 debug SyDEVS-static-debug optimized SyDEVS-static)</div><div class="line"></div><div class="line">set(PART02_DIR ${SIMULATIONS_DIR}/part02)</div><div class="line">aux_source_directory(${PART02_DIR} PART02_SRCS)</div><div class="line">add_executable(part02 ${PART02_SRCS} ${WAVEFORM_HDRS})</div><div class="line">target_link_libraries(part02 debug SyDEVS-static-debug optimized SyDEVS-static)</div></div><!-- fragment --><p>It's time now to add a SyDEVS node to the project. In the <code>sydevs_examples/src/examples/getting_started/waveform</code> folder, create a file named <code>square_wave_closed_system.h</code> and save it with the following code.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div><div class="line"><span class="preprocessor">#ifndef SYDEVS_EXAMPLES_SQUARE_WAVE_CLOSED_SYSTEM_H_</span></div><div class="line"><span class="preprocessor">#define SYDEVS_EXAMPLES_SQUARE_WAVE_CLOSED_SYSTEM_H_</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="atomic__node_8h.html">sydevs/systems/atomic_node.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span>sydevs_examples {</div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacesydevs.html">sydevs</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacesydevs_1_1systems.html">sydevs::systems</a>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">class </span>square_wave_closed_system : <span class="keyword">public</span> <a class="code" href="classsydevs_1_1systems_1_1atomic__node.html">atomic_node</a></div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="comment">// Constructor/Destructor:</span></div><div class="line">    square_wave_closed_system(<span class="keyword">const</span> std::string&amp; node_name, <span class="keyword">const</span> <a class="code" href="classsydevs_1_1systems_1_1node__context.html">node_context</a>&amp; external_context);</div><div class="line">    <span class="keyword">virtual</span> ~square_wave_closed_system() = <span class="keywordflow">default</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Attributes:</span></div><div class="line">    <span class="keyword">virtual</span> <a class="code" href="classsydevs_1_1scale.html">scale</a> time_precision()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="namespacesydevs.html#acb6264e292c734cb5ca7aa2b4edfcc1d">micro</a>; }</div><div class="line"></div><div class="line">    <span class="comment">// Ports:</span></div><div class="line"></div><div class="line"><span class="keyword">protected</span>:</div><div class="line">    <span class="comment">// State Variables:</span></div><div class="line">    <a class="code" href="classsydevs_1_1quantity.html">duration</a> period_dt;  <span class="comment">// duration of one period of the sqaure wave</span></div><div class="line">    <a class="code" href="namespacesydevs.html#a6ad89989cc401c02d2e6280a59686c31">float64</a> duty_cycle;  <span class="comment">// fraction (0 to 1) of each period spent in the &quot;on&quot; phase</span></div><div class="line">    <a class="code" href="classint64__t.html">int64</a> phase;         <span class="comment">// binary signal phase (0 =&gt; off, 1 =&gt; on)</span></div><div class="line"></div><div class="line">    <span class="comment">// Event Handlers:</span></div><div class="line">    <span class="keyword">virtual</span> <a class="code" href="classsydevs_1_1quantity.html">duration</a> initialization_event();</div><div class="line">    <span class="keyword">virtual</span> <a class="code" href="classsydevs_1_1quantity.html">duration</a> unplanned_event(<a class="code" href="classsydevs_1_1quantity.html">duration</a> elapsed_dt);</div><div class="line">    <span class="keyword">virtual</span> <a class="code" href="classsydevs_1_1quantity.html">duration</a> planned_event(<a class="code" href="classsydevs_1_1quantity.html">duration</a> elapsed_dt);</div><div class="line">    <span class="keyword">virtual</span> <span class="keywordtype">void</span> finalization_event(<a class="code" href="classsydevs_1_1quantity.html">duration</a> elapsed_dt);</div><div class="line">};</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">inline</span> square_wave_closed_system::square_wave_closed_system(<span class="keyword">const</span> std::string&amp; node_name, <span class="keyword">const</span> <a class="code" href="classsydevs_1_1systems_1_1node__context.html">node_context</a>&amp; external_context)</div><div class="line">    : <a class="code" href="classsydevs_1_1systems_1_1atomic__node.html">atomic_node</a>(node_name, external_context)</div><div class="line">{</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">inline</span> <a class="code" href="classsydevs_1_1quantity.html">duration</a> square_wave_closed_system::initialization_event()</div><div class="line">{</div><div class="line">    period_dt = (10<a class="code" href="namespacesydevs.html#a2d5b324c17eaf9b970ad09a2a77d7725">_s</a>).fixed_at(time_precision());</div><div class="line">    duty_cycle = 0.3;</div><div class="line">    phase = 0;</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;phase = &quot;</span> &lt;&lt; phase &lt;&lt; std::endl;</div><div class="line">    <span class="keywordflow">return</span> period_dt*(1.0 - duty_cycle);</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">inline</span> <a class="code" href="classsydevs_1_1quantity.html">duration</a> square_wave_closed_system::unplanned_event(<a class="code" href="classsydevs_1_1quantity.html">duration</a> elapsed_dt)</div><div class="line">{</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="namespacesydevs.html#a5dc8b39b907edd06f5c13f4df2854c29">duration</a>();</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">inline</span> <a class="code" href="classsydevs_1_1quantity.html">duration</a> square_wave_closed_system::planned_event(<a class="code" href="classsydevs_1_1quantity.html">duration</a> elapsed_dt)</div><div class="line">{</div><div class="line">    <a class="code" href="classsydevs_1_1quantity.html">duration</a> planned_dt;</div><div class="line">    <span class="keywordflow">if</span> (phase == 0) {</div><div class="line">        phase = 1;</div><div class="line">        planned_dt = period_dt*duty_cycle;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (phase == 1) {</div><div class="line">        phase = 0;</div><div class="line">        planned_dt = period_dt*(1.0 - duty_cycle);</div><div class="line">    }</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;phase = &quot;</span> &lt;&lt; phase &lt;&lt; std::endl;</div><div class="line">    <span class="keywordflow">return</span> planned_dt;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> square_wave_closed_system::finalization_event(<a class="code" href="classsydevs_1_1quantity.html">duration</a> elapsed_dt)</div><div class="line">{</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line">}  <span class="comment">// namespace</span></div><div class="line"></div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --><p>Let's make a few observations about this node.</p>
<ul>
<li>The node is in the namespace <code>sydevs_examples</code>. When you develop your own nodes, you'll want to place them in a different namespace that's specific to your project.</li>
<li>The name of the node ends with <code>_closed_system</code>, reflecting the fact the node has no ports. By convention, nodes that do have ports end with <code>_node</code>.</li>
<li>The node inherits from <code>atomic_node</code>. The other node base classes include <code>composite_node</code>, <code>collection_node</code>, and <code>function_node</code>.</li>
<li>When simulated, the <code>initialization_event</code> will be invoked once at the beginning, the <code>planned_event</code> will be invoked repeatedly as simulated time advances, and the <code>finalization_event</code> will be invoked once at the end. The <code>unplanned_event</code> will never be invoked because the node has no message input ports.</li>
<li>The node represents a square wave cycling between <code>phase = 0</code> (off) and <code>phase = 1</code> (on). A full cycle is 10 seconds (<code>period_dt</code>). The "on" phase lasts for 30% of this time (<code>duty_cycle</code>). Observe that the planned duration (<code>planned_dt</code>) is either 3 seconds (<code>period_dt*duty_cycle</code>) or 7 seconds (<code>period_dt*(1.0 - duty_cycle)</code>) depending on the phase. Whenever the planned duration elapses, the <code>planned_event</code> is invoked.</li>
</ul>
<p>Also in the <code>waveform</code> folder, create a file named <code>square_wave.h</code> and save it with the code below.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div><div class="line"><span class="preprocessor">#ifndef SYDEVS_EXAMPLES_SQUARE_WAVE_H_</span></div><div class="line"><span class="preprocessor">#define SYDEVS_EXAMPLES_SQUARE_WAVE_H_</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;examples/getting_started/waveform/square_wave_closed_system.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="simulation_8h.html">sydevs/systems/simulation.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">namespace </span>sydevs_examples {</div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacesydevs.html">sydevs</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacesydevs_1_1systems.html">sydevs::systems</a>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keywordtype">void</span> square_wave()</div><div class="line">{</div><div class="line">    <span class="keywordflow">try</span> {</div><div class="line">        <a class="code" href="classsydevs_1_1systems_1_1simulation.html">simulation&lt;square_wave_closed_system&gt;</a> sim(1_min, 0, std::cout);</div><div class="line">        sim.process_remaining_events();</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (<span class="keyword">const</span> <a class="code" href="classsydevs_1_1systems_1_1system__node_1_1error.html">system_node::error</a>&amp; e) {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;SYSTEM NODE ERROR: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e) {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;OTHER ERROR: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line">}  <span class="comment">// namespace</span></div><div class="line"></div><div class="line"><span class="preprocessor">#endif</span></div></div><!-- fragment --><p>Finally, in <code>sydevs_examples/src/simulations/part02</code>, save the following code as <code>main.cpp</code>.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;examples/getting_started/waveform/square_wave.h&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span>* argv[])</div><div class="line">{</div><div class="line">    sydevs_examples::square_wave();</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>Build the project and run the new executable <code>part02.exe</code>. It should produce the following output.</p>
<div class="fragment"><div class="line">phase = 0</div><div class="line">phase = 1</div><div class="line">phase = 0</div><div class="line">phase = 1</div><div class="line">phase = 0</div><div class="line">phase = 1</div><div class="line">phase = 0</div><div class="line">phase = 1</div><div class="line">phase = 0</div><div class="line">phase = 1</div><div class="line">phase = 0</div><div class="line">phase = 1</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="getting_started.html">Getting Started</a></li>
    <li class="footer">Generated on Fri Apr 13 2018 16:33:03 for SyDEVS by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.14 </li>
  </ul>
</div>
</body>
</html>
